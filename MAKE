

UCOSII_SOURCES = ucos/os_core.c \
 ucos/os_dbg_r.c \
 ucos/os_flag.c \
 ucos/os_mbox.c \
 ucos/os_mem.c \
 ucos/os_mutex.c \
 ucos/os_q.c \
 ucos/os_sem.c \
 ucos/os_task.c \
 ucos/os_time.c \
 ucos/os_tmr.c

UCOSII_ALL_SOURCES = ucos/ucos_ii.c
UCOSII_PORT_SOURCES = port/os_cpu_c.c port/pc.c


# Compiler options are quite flexible.  GCC versions have a significant impact
# on the size of -Os code, e.g. gcc-4.6 is much worse than gcc-4.5.

CC	= gcc
#CCOPTS	= -Os -pedantic -std=c99 -Wall -fstrict-aliasing -fomit-frame-pointer -static
CCOPTS	= -Os -Wall -static
CCOPTS += -Iucos  # for combined sources
CCOPTS += -Isrc  # for combined sources
CCOPTS += -Iport  # for combined sources
#CCOPTS += -m32 

CCLIBS	= -lm -lWinmm
DEFINES = -D__WIN32__=1

# If you want a 32-bit build on a 64-bit host
#CCOPTS += -m32

# For debugging, use -O0 -g -ggdb, and don't add -fomit-frame-pointer

# -fexec-charset=GBK
# -finput-charset=utf8
# -verbose

ucos_ii_win: $(UCOSII_PORT_SOURCES) $(UCOSII_ALL_SOURCES) src/test.c
	$(CC) -o $@ $(DEFINES) $(CCOPTS) $(UCOSII_ALL_SOURCES) $(UCOSII_PORT_SOURCES) src/test.c $(CCLIBS)

ucos_ii_port: $(UCOSII_PORT_SOURCES)
	$(CC) -c $(DEFINES) $(CCOPTS) $(UCOSII_PORT_SOURCES) $(CCLIBS)

ucos_ii: $(UCOSII_ALL_SOURCES)
	$(CC) -c $(DEFINES) $(CCOPTS) $(UCOSII_ALL_SOURCES) $(CCLIBS)